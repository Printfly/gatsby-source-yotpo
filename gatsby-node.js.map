{"version":3,"file":"gatsby-node.js","names":["sourceNodes","gatsbyArgs","pluginOptions","actions","createNodeId","createContentDigest","nodeHelpers","createNodeHelpers","typePrefix","createNodeFactory","createNode","appKey","console","log","process","exit","appSecret","fetchData","env","ASSETS_URL","reviews","productBottomlines","siteBottomlines","Promise","all","map","review","type","sku","Node","node","dataString","JSON","stringify","data","id","title","content","score","productIdentifier","toLowerCase","sentiment","votesUp","votes_up","votesDown","votes_down","name","email","reviewerType","reviewer_type","createdAt","created_at","updatedAt","updated_at","bottomline","domain_key","product_score","totalReviews","total_reviews","average_score"],"sources":["src/gatsby-node.js"],"sourcesContent":["import { createNodeHelpers } from \"gatsby-node-helpers\";\nimport fetchData from \"./fetch\";\n\nexport const sourceNodes = async (\n  gatsbyArgs,\n  pluginOptions\n) => {\n  const { actions, createNodeId, createContentDigest } = gatsbyArgs;\n  const nodeHelpers = createNodeHelpers({\n    typePrefix: \"Yotpo\",\n    createNodeId,\n    createContentDigest,\n  });\n  const { createNodeFactory } = nodeHelpers;\n  const { createNode } = actions;\n\n  if (!pluginOptions.appKey) {\n    console.log(\"\\nMake sure options has appKey\");\n    process.exit(1);\n  }\n\n  if (!pluginOptions.appSecret) {\n    console.log(\"\\nMake sure options has appSecret\");\n    process.exit(1);\n  }\n\n  const { reviews, productBottomlines, siteBottomlines } = await fetchData(\n    process.env.ASSETS_URL\n  );\n\n  await Promise.all(\n    reviews.map(async (review) => {\n      const type =\n        review.sku === \"yotpo_site_reviews\" ? \"SiteReview\" : \"ProductReview\";\n      const Node = createNodeFactory(type, async (node) => {\n        node.dataString = JSON.stringify(node.data);\n\n        return node;\n      });\n\n      if (review.sku) {\n        const data = {\n          id: review.id,\n          title: review.title,\n          content: review.content,\n          score: review.score,\n          productIdentifier: review.sku.toLowerCase(),\n          sentiment: review.sentiment,\n          votesUp: review.votes_up,\n          votesDown: review.votes_down,\n          name: review.name,\n          email: review.email,\n          reviewerType: review.reviewer_type,\n          createdAt: review.created_at,\n          updatedAt: review.updated_at,\n        };\n\n        const node = await Node(data);\n        createNode(node);\n      }\n    }),\n    productBottomlines.map(async (bottomline) => {\n      const type = \"ProductBottomline\";\n      const Node = createNodeFactory(type, async (node) => {\n        node.dataString = JSON.stringify(node.data);\n\n        return node;\n      });\n\n      const data = {\n        id: bottomline.domain_key,\n        score: bottomline.product_score,\n        totalReviews: bottomline.total_reviews,\n        productIdentifier: bottomline.domain_key.toLowerCase(),\n      };\n\n      const node = await Node(data);\n      createNode(node);\n    }),\n    siteBottomlines.map(async (bottomline) => {\n      const type = \"SiteBottomline\";\n      const Node = createNodeFactory(type, async (node) => {\n        node.dataString = JSON.stringify(node.data);\n\n        return node;\n      });\n\n      const data = {\n        id: \"SiteBottomline\",\n        score: bottomline.average_score,\n        totalReviews: bottomline.total_reviews,\n      };\n\n      const node = await Node(data);\n      createNode(node);\n    })\n  );\n};\n"],"mappings":"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"}
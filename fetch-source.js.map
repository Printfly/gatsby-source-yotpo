{"version":3,"file":"fetch-source.js","names":["appKey","appSecret","console","time","log","getAccessToken","accessToken","Error","pagedGet","allReviews","reviews","allProductBottomlines","productBottomlines","allSiteBottomlines","page","pageSize","siteBottomlines","timeEnd","method","options","aggregatedResponse","concat","length"],"sources":["src/fetch-source.js"],"sourcesContent":["import {\n  getAccessToken,\n  allReviews,\n  allProductBottomlines,\n  allSiteBottomlines,\n} from \"./yotpo\";\n\nexport default async ({ appKey, appSecret }) => {\n  console.time(`Fetch Yotpo reviews`);\n  console.log(`Starting to fetch reviews from Yotpo`);\n\n  const accessToken = await getAccessToken({\n    appKey,\n    appSecret,\n  });\n\n  if (!accessToken) {\n    throw new Error('Access token not found!!!');\n  }\n  const reviews = await pagedGet(allReviews, {\n    appKey,\n    accessToken,\n  });\n\n  const productBottomlines = await pagedGet(allProductBottomlines, {\n    appKey,\n    accessToken,\n  });\n\n  const siteBottomlines = await allSiteBottomlines({\n    appKey,\n    accessToken,\n    page: 1,\n    pageSize: 1,\n  });\n\n  console.timeEnd(`Fetch Yotpo reviews`);\n\n  return {\n    reviews,\n    productBottomlines,\n    siteBottomlines,\n  };\n};\n\nasync function pagedGet(\n  method,\n  options,\n  page = 1,\n  pageSize = 75,\n  aggregatedResponse = null\n) {\n  const reviews = await method({\n    ...options,\n    page,\n    pageSize,\n  });\n  if (!aggregatedResponse) {\n    aggregatedResponse = reviews;\n  } else {\n    aggregatedResponse = aggregatedResponse.concat(reviews);\n  }\n\n  if (reviews && reviews.length > 0) {\n    return pagedGet(method, options, page + 1, pageSize, aggregatedResponse);\n  }\n\n  return aggregatedResponse;\n}\n"],"mappings":";;;;;;;;;;AAAA;AAKiB;AAAA;AAAA;EAAA,yFAEF;IAAA;IAAA;MAAA;QAAA;UAAA;YAASA,MAAM,SAANA,MAAM,EAAEC,SAAS,SAATA,SAAS;YACvCC,OAAO,CAACC,IAAI,uBAAuB;YACnCD,OAAO,CAACE,GAAG,wCAAwC;YAAC;YAAA,OAE1B,IAAAC,qBAAc,EAAC;cACvCL,MAAM,EAANA,MAAM;cACNC,SAAS,EAATA;YACF,CAAC,CAAC;UAAA;YAHIK,WAAW;YAAA,IAKZA,WAAW;cAAA;cAAA;YAAA;YAAA,MACR,IAAIC,KAAK,CAAC,2BAA2B,CAAC;UAAA;YAAA;YAAA,OAExBC,QAAQ,CAACC,iBAAU,EAAE;cACzCT,MAAM,EAANA,MAAM;cACNM,WAAW,EAAXA;YACF,CAAC,CAAC;UAAA;YAHII,OAAO;YAAA;YAAA,OAKoBF,QAAQ,CAACG,4BAAqB,EAAE;cAC/DX,MAAM,EAANA,MAAM;cACNM,WAAW,EAAXA;YACF,CAAC,CAAC;UAAA;YAHIM,kBAAkB;YAAA;YAAA,OAKM,IAAAC,yBAAkB,EAAC;cAC/Cb,MAAM,EAANA,MAAM;cACNM,WAAW,EAAXA,WAAW;cACXQ,IAAI,EAAE,CAAC;cACPC,QAAQ,EAAE;YACZ,CAAC,CAAC;UAAA;YALIC,eAAe;YAOrBd,OAAO,CAACe,OAAO,uBAAuB;YAAC,iCAEhC;cACLP,OAAO,EAAPA,OAAO;cACPE,kBAAkB,EAAlBA,kBAAkB;cAClBI,eAAe,EAAfA;YACF,CAAC;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CACF;EAAA;IAAA;EAAA;AAAA;AAAA;AAAA,SAEcR,QAAQ;EAAA;AAAA;AAAA;EAAA,0FAAvB,kBACEU,MAAM,EACNC,OAAO;IAAA;MAAA;MAAA;MAAA;MAAA;IAAA;MAAA;QAAA;UAAA;YACPL,IAAI,8DAAG,CAAC;YACRC,QAAQ,8DAAG,EAAE;YACbK,kBAAkB,8DAAG,IAAI;YAAA;YAAA,OAEHF,MAAM,iCACvBC,OAAO;cACVL,IAAI,EAAJA,IAAI;cACJC,QAAQ,EAARA;YAAQ,GACR;UAAA;YAJIL,OAAO;YAKb,IAAI,CAACU,kBAAkB,EAAE;cACvBA,kBAAkB,GAAGV,OAAO;YAC9B,CAAC,MAAM;cACLU,kBAAkB,GAAGA,kBAAkB,CAACC,MAAM,CAACX,OAAO,CAAC;YACzD;YAAC,MAEGA,OAAO,IAAIA,OAAO,CAACY,MAAM,GAAG,CAAC;cAAA;cAAA;YAAA;YAAA,kCACxBd,QAAQ,CAACU,MAAM,EAAEC,OAAO,EAAEL,IAAI,GAAG,CAAC,EAAEC,QAAQ,EAAEK,kBAAkB,CAAC;UAAA;YAAA,kCAGnEA,kBAAkB;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAC1B;EAAA;AAAA"}